<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simple Google OAuth with Magic</title>
  <script src="https://auth.magic.link/sdk"></script>
  <script src="https://auth.magic.link/sdk/extension/oauth"></script>
</head>
<body onload="render()">
  <div id="app">Loading...</div>

  <script>
    const MAGIC_API_KEY = "pk_live_4196A5A589C7E50D";  // Replace with your actual Magic API key

    // Initialize Magic with OAuth extension
    const magic = new Magic(MAGIC_API_KEY, {
      extensions: [new MagicOAuthExtension()],
    });

    // Function to render content based on the current path
    const render = async () => {
      let html = "";

      // Check if we're on the callback path after login
      if (window.location.pathname === "/callback") {
        try {
          // Retrieve the OAuth result from Magic
          await magic.oauth.getRedirectResult();

          // Redirect to test.html upon successful login
          window.location.href = "/test.html";
        } catch (error) {
          console.error("Error retrieving Magic OAuth result:", error);
          window.location.href = "/";  // Redirect to home if thereâ€™s an error
        }
      } else {
        // Show the login button if not on the callback page
        html = `
          <h2>Please sign up or log in</h2>
          <button onclick="handleLogin()" id="btn-login">Continue with Google</button>
        `;
      }

      document.getElementById("app").innerHTML = html;
    };

    // Function to start the OAuth login flow
    const handleLogin = async () => {
      const btnLogin = document.getElementById("btn-login");
      btnLogin.disabled = true;
      btnLogin.innerText = "Logging in...";

      // Start the Google OAuth 2.0 flow with Magic
      await magic.oauth.loginWithRedirect({
        provider: "google",
        redirectURI: `${window.location.origin}/callback`  // Ensure this matches your Magic Dashboard and Google settings
      });
    };
  </script>
</body>
</html>

