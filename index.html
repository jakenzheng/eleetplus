<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <title>Eleet+ Google OAuth with Magic</title>

    <!-- Magic Library -->
    <script src="https://auth.magic.link/sdk"></script>
    <script src="https://auth.magic.link/sdk/extension/oauth"></script>

    <!-- Inline styling for layout and popup -->
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
      }

      #app {
        text-align: center;
        padding: 20px;
        border-radius: 8px;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      #success-popup {
        display: none;
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #4CAF50;
        color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        font-size: 18px;
      }
    </style>
  </head>

  <body onload="render()">
    <div id="app">
      <h2>Welcome to Eleet+</h2>
      <p>Please continue with Google to proceed.</p>

      <!-- Google Sign-In Button -->
      <button onclick="handleLogin()" id="btn-login" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
        Continue with Google
      </button>

      <!-- Success Popup -->
      <div id="success-popup">Login was successful! Redirecting...</div>
    </div>

    <script>
      const MAGIC_API_KEY = "pk_live_4196A5A589C7E50D";

      // Initialize Magic with OAuth extension
      const magic = new Magic(MAGIC_API_KEY, {
        extensions: [new MagicOAuthExtension()],
      });

      // Render function to show content based on path
      const render = async () => {
        if (window.location.pathname === "/callback") {
          try {
            // Retrieve the OAuth result from Magic
            const result = await magic.oauth.getRedirectResult();
            const profile = JSON.stringify(result.oauth.userInfo, undefined, 2);

            // Show success message and redirect to test.html
            showSuccessPopup();
          } catch (error) {
            console.error("Error retrieving Magic OAuth result:", error);
            window.location.href = window.location.origin;
          }
        }
      };

      // Function to start the OAuth login flow
      const handleLogin = async () => {
        const btnLogin = document.getElementById("btn-login");
        btnLogin.disabled = true;
        btnLogin.innerText = "Logging in...";

        await magic.oauth.loginWithRedirect({
          provider: "google",
          redirectURI: `${window.location.origin}/callback`
        });
      };

      // Show the success popup and redirect to test.html after a delay
      function showSuccessPopup() {
        const popup = document.getElementById("success-popup");
        popup.style.display = "block";

        setTimeout(() => {
          popup.style.display = "none";
          window.location.href = "/test.html";
        }, 2000);
      }
    </script>
  </body>
</html>

